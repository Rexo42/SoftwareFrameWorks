<app-nav-bar></app-nav-bar>

<div class="container mt-3">

  <ul class="nav nav-tabs mb-3">
    @if (isSuperAdmin) {
      <li class="nav-item">
        <a 
          class="nav-link" 
          [class.active]="pageType === 'Users'" 
          (click)="pageType = 'Groups'; pageNumber = 1; changePageCategory()"
          style="cursor: pointer; font-size: 1.25rem; font-weight: 500;"
        >
          Users
        </a>
      </li>
    }
    <li class="nav-item">
      <a 
        class="nav-link" 
        [class.active]="pageType === 'Groups'" 
        (click)="pageType = 'Users'; pageNumber = 1; changePageCategory()"
        style="cursor: pointer; font-size: 1.25rem; font-weight: 500;"
      >
        Groups
      </a>
    </li>
  </ul>

  @if (pageType === 'Users') {
    <ul class="list-group">
      @for (user of formattedData; track user.ID) {
        <li class="list-group-item d-flex justify-content-between align-items-center py-2">
          <span>
            <strong>UserID:</strong> {{ user.ID }} |
            <strong>Username:</strong> {{ user.username }} |
            <strong>Role:</strong> {{ user.role }}
          </span>
          <div>
            <button [disabled]="user.username === 'test1'" class="btn btn-danger btn-sm mx-1" (click)="deleteUser(user.ID, user.username)">
              Delete
            </button>
            <button [disabled]="user.role === 'User' || user.username === 'test1'" class="btn btn-dark btn-sm mx-1" (click)="updateUserRole('User', user.username)">
              Demote to User
            </button>
            <button [disabled]="user.role === 'GroupAdmin' || user.username === 'test1'" class="btn btn-warning btn-sm mx-1" (click)="updateUserRole('GroupAdmin', user.username)">
              Promote to Group Admin
            </button>
            <button [disabled]="user.role === 'SuperAdmin'" class="btn btn-primary btn-sm mx-1" (click)="updateUserRole('SuperAdmin', user.username)">
              Promote to Super Admin
            </button>
          </div>
        </li>
      }
    </ul>
  }

  @if (pageType === 'Groups') {
    <ul class="list-group">
      @for (group of formattedGroupData; track group.groupID) {
        <li class="list-group-item d-flex justify-content-between align-items-center py-2">
          <span>
            <strong>GroupID:</strong> {{ group.groupID }} |
            <strong>Group Name:</strong> {{ group.groupName }} |
            <strong>Creator:</strong> {{ group.groupCreator }}
          </span>
          <div>
            <button [disabled]="group.groupName === 'test1'" class="btn btn-danger btn-sm mx-1" (click)="deleteGroup(group.groupID)">
              Delete
            </button>
          </div>
        </li>
      }
    </ul>
  }

  <div class="d-flex justify-content-between align-items-center mt-4">
    <button 
      class="btn btn-outline-secondary btn-sm"
      [disabled]="pageNumber === 1"
      (click)="pageUpdate(0)"
    >
      &laquo; Previous
    </button>

    <p class="mb-0 fw-medium">Page {{ pageNumber }} of {{ totalPages }}</p>

    <button 
      class="btn btn-outline-secondary btn-sm"
      [disabled]="pageNumber === totalPages"
      (click)="pageUpdate(1)"
    >
      Next &raquo;
    </button>
  </div>

  <div class="mt-4">
    @if (pageType === 'Users' && isSuperAdmin) {
      <div class="list-group-item py-3" style="max-width: 800px; margin: auto;">
        <app-create-account (userCreated)="refreshUsers()" (handleMessage)="handleMessage($event)"></app-create-account>
      </div>
    }
    @else 
    {
      <app-create-group (groupCreated)="refreshGroups()" (handleMessage)="handleMessage($event)"></app-create-group>
      <app-delete-channel [groupList] ="formattedGroupData" (channelDeleted) = "deleteChannel($event)"> </app-delete-channel>
      <app-create-channel [groupList]="formattedGroupData" (channelCreated)="refreshGroups()" (handleMessage)="handleMessage($event)"></app-create-channel>
      <app-approve-member [groupList]="formattedGroupData" (userApproved)="refreshGroups()" (handleMessage)="handleMessage($event)"></app-approve-member>
    }
  </div>
  @if(errorMsg)
  {
  <div *ngIf="errorMsg" class="mt-2 alert alert-info text-center p-1 m-0">
    {{ errorMsg }}
  </div>
  }
</div>
